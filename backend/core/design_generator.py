#!/usr/bin/env python3
"""
è®¾è®¡AIç”Ÿæˆå™¨ - ç”Ÿæˆç”µå•†æµ·æŠ¥è®¾è®¡æ–¹æ¡ˆ
"""

import os
import base64
import asyncio
from pathlib import Path
from typing import List
import aiohttp
from dotenv import load_dotenv

# åŠ è½½ç¯å¢ƒå˜é‡
load_dotenv()

# ä»ç¯å¢ƒå˜é‡è¯»å–é…ç½®
BASE_URL = os.getenv("API_BASE_URL", "https://ent.zetatechs.com/v1")
API_KEY = os.getenv("API_KEY", "")
MODEL_NAME = os.getenv("DESIGN_MODEL_NAME", "gemini-3-pro-preview-thinking")

SYSTEM_PROMPT = """
# ä»»åŠ¡è¯´æ˜
# ä»»åŠ¡è¯´æ˜ æˆ‘éœ€è¦ä¸ºã€æˆ‘çš„äº§å“ã€‘ç”Ÿæˆä¸€å¥—å®Œæ•´çš„ç”µå•†KVè§†è§‰ç³»ç»Ÿæç¤ºè¯ï¼ˆç¤ºä¾‹ä»…ä½œä¸ºå·¥ä½œæ–¹å¼å‚è€ƒï¼Œä¸è¦å‚è€ƒå…·ä½“å†…å®¹ï¼‰ï¼ˆ10å¼ æµ·æŠ¥ï¼Œ9:16ç«–ç‰ˆæ ¼å¼ï¼‰ã€‚
ç¬¬ä¸€æ­¥ï¼šäº§å“ä¿¡æ¯æ™ºèƒ½æå–ï¼ˆå¦‚æœä¸Šä¼ äº†å›¾ç‰‡ï¼‰
è¯·ä»”ç»†åˆ†ææˆ‘ä¸Šä¼ çš„äº§å“å›¾ç‰‡ï¼Œè‡ªåŠ¨æå–ä»¥ä¸‹ä¿¡æ¯ï¼š ## è‡ªåŠ¨è¯†åˆ«é¡¹ç›®ï¼š
å“ç‰Œåç§°è¯†åˆ«   - ä»åŒ…è£…/äº§å“ä¸Šè¯†åˆ«å“ç‰ŒLOGOæ–‡å­—   - è¯†åˆ«ä¸­æ–‡å“ç‰Œåå’Œè‹±æ–‡å“ç‰Œå   - æå–å“ç‰Œæ ‡å¿—çš„è®¾è®¡é£æ ¼ï¼ˆå­—ä½“ã€å›¾æ ‡ã€é…è‰²ï¼‰
äº§å“ç±»å‹åˆ¤æ–­**   - è¯†åˆ«äº§å“æ‰€å±ç±»åˆ«ï¼ˆæœè£…/é£Ÿå“/ç”µå­/ç¾å¦†/å®¶å±…/å® ç‰©ç”¨å“ç­‰ï¼‰   - è¯†åˆ«å…·ä½“äº§å“åç§°ï¼ˆä»åŒ…è£…æ–‡å­—æˆ–äº§å“å½¢æ€åˆ¤æ–­ï¼‰   - è¯†åˆ«äº§å“è§„æ ¼ï¼ˆå°ºå¯¸ã€å®¹é‡ã€é‡é‡ç­‰ï¼‰
å–ç‚¹æå–   - ä»åŒ…è£…ä¸Šçš„æ–‡æ¡ˆæå–æ ¸å¿ƒå–ç‚¹å…³é”®è¯   - ä»äº§å“å›¾æ ‡/è®¤è¯æ ‡è¯†æå–å–ç‚¹ï¼ˆå¦‚ï¼šæœ‰æœºè®¤è¯ã€æ— æ·»åŠ ã€è¿›å£ç­‰ï¼‰   - ä»äº§å“è§†è§‰ç‰¹å¾æ¨æ–­å–ç‚¹ï¼ˆå¦‚ï¼šé¢œè‰²ã€æè´¨ã€å·¥è‰ºï¼‰   - æå–æ•°æ®å–ç‚¹ï¼ˆå¦‚ï¼šç™¾åˆ†æ¯”ã€å«é‡ã€æ—¶é•¿ç­‰ï¼‰
é…è‰²æ–¹æ¡ˆåˆ†æ   - æå–åŒ…è£…ä¸»è‰²è°ƒï¼ˆRGB/HEXè‰²å€¼ï¼‰   - è¯†åˆ«è¾…åŠ©è‰²å’Œç‚¹ç¼€è‰²   - åˆ†æé…è‰²é£æ ¼ï¼ˆæ¸…æ–°/æ²‰ç¨³/é²œè‰³/é«˜çº§ç­‰ï¼‰
è®¾è®¡é£æ ¼åˆ¤æ–­   - è¯†åˆ«åŒ…è£…è®¾è®¡é£æ ¼ï¼ˆæç®€/å¤å¤/å¯çˆ±/ç§‘æŠ€/è‰ºæœ¯ç­‰ï¼‰   - è¯†åˆ«å­—ä½“é£æ ¼ï¼ˆè¡¬çº¿/æ— è¡¬çº¿/æ‰‹å†™ç­‰ï¼‰   - è¯†åˆ«å›¾æ¡ˆå…ƒç´ ï¼ˆæ°´å½©/å‡ ä½•/æ’ç”»/æ‘„å½±ï¼‰
ç›®æ ‡å—ä¼—æ¨æ–­   - æ ¹æ®åŒ…è£…é£æ ¼æ¨æ–­ç›®æ ‡ç”¨æˆ·ç¾¤ä½“   - æ ¹æ®äº§å“ç±»å‹æ¨æ–­å¹´é¾„æ®µ   - æ ¹æ®ä»·æ ¼å®šä½æ¨æ–­æ¶ˆè´¹å±‚çº§
äº§å“å‚æ•°æå–   - ä»åŒ…è£…æ–‡å­—æå–äº§å“è§„æ ¼ï¼ˆå‡€å«é‡/å°ºç /åŠŸç‡ç­‰ï¼‰   - æå–æˆåˆ†ä¿¡æ¯/é…æ–™è¡¨/è¥å…»æˆåˆ†   - æå–ä½¿ç”¨è¯´æ˜/æ³¨æ„äº‹é¡¹   - æå–ç”Ÿäº§æ—¥æœŸ/ä¿è´¨æœŸ/å‚¨å­˜æ–¹å¼ã€‚
äº§å“ç»†èŠ‚è¯†åˆ«   
- è¯†åˆ«äº§å“æè´¨è´¨æ„Ÿï¼ˆå…‰æ»‘/ç²—ç³™/å“‘å…‰/é«˜å…‰ç­‰ï¼‰
è¯†åˆ«äº§å“ç»“æ„ç‰¹ç‚¹ï¼ˆå¯æ‹†å¸/æŠ˜å /ä¾¿æºç­‰ï¼‰
è¯†åˆ«åŒ…è£…ç‰¹è‰²ï¼ˆè‡ªå°è¢‹/æ³µå¤´/å–·é›¾/æ»´ç®¡ç­‰ï¼‰
è¾“å‡ºæ ¼å¼ï¼š
è¯·å°†è¯†åˆ«ç»“æœæ•´ç†ä¸ºä»¥ä¸‹æ ¼å¼ï¼š
ã€è¯†åˆ«æŠ¥å‘Šã€‘
å“ç‰Œåç§°ï¼š[ä¸­æ–‡] / [è‹±æ–‡] 
äº§å“ç±»å‹ï¼š[å¤§ç±»] - [å…·ä½“äº§å“] 
äº§å“è§„æ ¼ï¼š[å…·ä½“è§„æ ¼] 
æ ¸å¿ƒå–ç‚¹ï¼š[å–ç‚¹1 - ä¸­è‹±æ–‡]
[å–ç‚¹2 - ä¸­è‹±æ–‡]
[å–ç‚¹3 - ä¸­è‹±æ–‡]
[å–ç‚¹4 - ä¸­è‹±æ–‡]
[å–ç‚¹5 - ä¸­è‹±æ–‡]
ä¸»è‰²è°ƒï¼š[é¢œè‰²åç§°] (#HEX) + [é¢œè‰²åç§°] (#HEX)
è¾…åŠ©è‰²ï¼š[é¢œè‰²åç§°] (#HEX)
è®¾è®¡é£æ ¼ï¼š[é£æ ¼æè¿°]
ç›®æ ‡å—ä¼—ï¼š[ç”¨æˆ·ç”»åƒ]
å“ç‰Œè°ƒæ€§ï¼š[è°ƒæ€§æè¿°]
åŒ…è£…äº®ç‚¹ï¼š[ç‰¹æ®Šè®¾è®¡å…ƒç´ ]
ç¬¬äºŒæ­¥ï¼šè§†è§‰é£æ ¼é€‰æ‹© 
åŸºäºè¯†åˆ«çš„äº§å“ä¿¡æ¯ï¼Œè¯·æ¨èæœ€é€‚åˆçš„è§†è§‰é£æ ¼ï¼ˆä¹Ÿå¯æ‰‹åŠ¨æŒ‡å®šï¼‰ï¼šè§†è§‰é£æ ¼é€‰é¡¹
ï¼ˆAIè‡ªåŠ¨æ¨èæˆ–æ‰‹åŠ¨é€‰æ‹©ï¼‰
â–¡ æ‚å¿—ç¼–è¾‘é£æ ¼ï¼ˆé«˜çº§ã€ä¸“ä¸šã€å¤§ç‰‡æ„Ÿã€ç²—è¡¬çº¿æ ‡é¢˜ã€æç®€ç•™ç™½ï¼‰
â–¡ æ°´å½©è‰ºæœ¯é£æ ¼ï¼ˆæ¸©æš–ã€æŸ”å’Œã€æ™•æŸ“æ•ˆæœã€æ‰‹ç»˜è´¨æ„Ÿï¼‰
â–¡ ç§‘æŠ€æœªæ¥é£æ ¼ï¼ˆå†·è‰²è°ƒã€å‡ ä½•å›¾å½¢ã€æ•°æ®å¯è§†åŒ–ã€è“å…‰æ•ˆæœï¼‰
â–¡ å¤å¤èƒ¶ç‰‡é£æ ¼ï¼ˆé¢—ç²’è´¨æ„Ÿã€æš–è‰²è°ƒã€æ€€æ—§æ°›å›´ã€å®ä¸½æ¥è¾¹æ¡†ï¼‰
â–¡ æç®€åŒ—æ¬§é£æ ¼ï¼ˆæ€§å†·æ·¡ã€å¤§ç•™ç™½ã€å‡ ä½•çº¿æ¡ã€é»‘ç™½ç°ï¼‰
â–¡ éœ“è™¹èµ›åšé£æ ¼ï¼ˆè§å…‰è‰²ã€æè¾¹å‘å…‰ã€æœªæ¥éƒ½å¸‚ã€æš—è‰²èƒŒæ™¯ï¼‰
â–¡ è‡ªç„¶æœ‰æœºé£æ ¼ï¼ˆæ¤ç‰©å…ƒç´ ã€å¤§åœ°è‰²ç³»ã€æ‰‹å·¥è´¨æ„Ÿã€ç¯ä¿ç†å¿µï¼‰
AIæ¨èä¾æ®ï¼š - æ ¹æ®äº§å“ç±»å‹è‡ªåŠ¨åŒ¹é…æœ€ä½³é£æ ¼ - æ ¹æ®åŒ…è£…è®¾è®¡é£æ ¼å»¶ç»­å“ç‰Œè°ƒæ€§ - æ ¹æ®ç›®æ ‡å—ä¼—å®¡ç¾åå¥½æ¨è --
ç¬¬ä¸‰æ­¥ï¼šæ–‡å­—æ’ç‰ˆæ•ˆæœé€‰æ‹©
æ–‡å­—æ’ç‰ˆæ•ˆæœï¼ˆAIè‡ªåŠ¨æ¨èæˆ–æ‰‹åŠ¨é€‰æ‹©ï¼‰
â–¡ ç²—è¡¬çº¿å¤§æ ‡é¢˜ + ç»†çº¿è£…é¥° + ç½‘æ ¼å¯¹é½ï¼ˆæ‚å¿—é£ï¼‰
â–¡ ç»ç’ƒæ‹Ÿæ€å¡ç‰‡ + åŠé€æ˜èƒŒæ™¯ + æŸ”å’Œåœ†è§’ï¼ˆç°ä»£é£ï¼‰
â–¡ 3Dæµ®é›•æ–‡å­— + é‡‘å±è´¨æ„Ÿ + å…‰å½±æ•ˆæœï¼ˆå¥¢åé£ï¼‰
â–¡ æ‰‹å†™ä½“æ ‡æ³¨ + æ°´å½©ç¬”è§¦ + ä¸è§„åˆ™å¸ƒå±€ï¼ˆè‰ºæœ¯é£ï¼‰
â–¡ æ— è¡¬çº¿ç²—ä½“ + éœ“è™¹æè¾¹ + å‘å…‰æ•ˆæœï¼ˆèµ›åšé£ï¼‰
â–¡ æç»†çº¿æ¡å­— + å¤§é‡ç•™ç™½ + ç²¾ç¡®å¯¹é½ï¼ˆæç®€é£ï¼‰
ç¬¬å››æ­¥ï¼šç”Ÿæˆå®Œæ•´æç¤ºè¯ç³»ç»Ÿ
è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹è¦æ±‚ç”Ÿæˆï¼šè§†è§‰é£æ ¼é€‰æ‹©ï¼ˆå¿…é€‰å…¶ä¸€ï¼‰
â–¡ æ‚å¿—ç¼–è¾‘é£æ ¼ï¼ˆé«˜çº§ã€ä¸“ä¸šã€å¤§ç‰‡æ„Ÿã€ç²—è¡¬çº¿æ ‡é¢˜ã€æç®€ç•™ç™½ï¼‰
â–¡ æ°´å½©è‰ºæœ¯é£æ ¼ï¼ˆæ¸©æš–ã€æŸ”å’Œã€æ™•æŸ“æ•ˆæœã€æ‰‹ç»˜è´¨æ„Ÿï¼‰
â–¡ ç§‘æŠ€æœªæ¥é£æ ¼ï¼ˆå†·è‰²è°ƒã€å‡ ä½•å›¾å½¢ã€æ•°æ®å¯è§†åŒ–ã€è“å…‰æ•ˆæœï¼‰
â–¡ å¤å¤èƒ¶ç‰‡é£æ ¼ï¼ˆé¢—ç²’è´¨æ„Ÿã€æš–è‰²è°ƒã€æ€€æ—§æ°›å›´ã€å®ä¸½æ¥è¾¹æ¡†ï¼‰
â–¡ æç®€åŒ—æ¬§é£æ ¼ï¼ˆæ€§å†·æ·¡ã€å¤§ç•™ç™½ã€å‡ ä½•çº¿æ¡ã€é»‘ç™½ç°ï¼‰
â–¡ éœ“è™¹èµ›åšé£æ ¼ï¼ˆè§å…‰è‰²ã€æè¾¹å‘å…‰ã€æœªæ¥éƒ½å¸‚ã€æš—è‰²èƒŒæ™¯ï¼‰
â–¡ è‡ªç„¶æœ‰æœºé£æ ¼ï¼ˆæ¤ç‰©å…ƒç´ ã€å¤§åœ°è‰²ç³»ã€æ‰‹å·¥è´¨æ„Ÿã€ç¯ä¿ç†å¿µï¼‰ 
# æ–‡å­—æ’ç‰ˆæ•ˆæœï¼ˆå¿…é€‰å…¶ä¸€ï¼‰ 
â–¡ ç²—è¡¬çº¿å¤§æ ‡é¢˜ + ç»†çº¿è£…é¥° + ç½‘æ ¼å¯¹é½ï¼ˆæ‚å¿—é£ï¼‰
â–¡ ç»ç’ƒæ‹Ÿæ€å¡ç‰‡ + åŠé€æ˜èƒŒæ™¯ + æŸ”å’Œåœ†è§’ï¼ˆç°ä»£é£ï¼‰
â–¡ 3Dæµ®é›•æ–‡å­— + é‡‘å±è´¨æ„Ÿ + å…‰å½±æ•ˆæœï¼ˆå¥¢åé£ï¼‰
â–¡ æ‰‹å†™ä½“æ ‡æ³¨ + æ°´å½©ç¬”è§¦ + ä¸è§„åˆ™å¸ƒå±€ï¼ˆè‰ºæœ¯é£ï¼‰
â–¡ æ— è¡¬çº¿ç²—ä½“ + éœ“è™¹æè¾¹ + å‘å…‰æ•ˆæœï¼ˆèµ›åšé£ï¼‰
â–¡ æç»†çº¿æ¡å­— + å¤§é‡ç•™ç™½ + ç²¾ç¡®å¯¹é½ï¼ˆæç®€é£ï¼‰
ç‰¹æ®Šéœ€æ±‚ï¼ˆå¯é€‰ï¼‰
ã€æ˜¯å¦éœ€è¦æ¨¡ç‰¹ã€‘ï¼šæ˜¯ / å¦ï¼ˆå¦‚æœæ˜¯ï¼Œæè¿°æ¨¡ç‰¹ç±»å‹ï¼‰
ã€æ˜¯å¦éœ€è¦åœºæ™¯ã€‘ï¼šæ˜¯ / å¦ï¼ˆå¦‚æœæ˜¯ï¼Œæè¿°åœºæ™¯ç±»å‹ï¼‰
ã€æ˜¯å¦éœ€è¦æ•°æ®å¯è§†åŒ–ã€‘ï¼šæ˜¯ / å¦ã€å…¶ä»–ç‰¹æ®Šè¦æ±‚ã€‘ï¼š[å¦‚ï¼šå¿…é¡»åŒ…å«äº§å“å®ç‰©ã€éœ€è¦å¯¹æ¯”å›¾ã€éœ€è¦ç”¨æˆ·è¯„ä»·ç­‰] --- 
# ç”Ÿæˆè¦æ±‚ è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹ç»“æ„è¾“å‡ºå®Œæ•´æç¤ºè¯ç³»ç»Ÿï¼š
è¾“å‡ºç»“æ„ï¼š
LOGOç”Ÿæˆæç¤ºè¯ï¼ˆä¸­è‹±åŒè¯­ï¼ŒåŸºäºè¯†åˆ«çš„å“ç‰Œè®¾è®¡é£æ ¼ï¼‰
æµ·æŠ¥01 - ä¸»KVè§†è§‰ï¼ˆHero Shotï¼Œå¿…é¡»ä¸¥æ ¼è¿˜åŸä¸Šä¼ çš„äº§å“å›¾ï¼‰
æµ·æŠ¥02 - ç”Ÿæ´»åœºæ™¯/ä½¿ç”¨åœºæ™¯ï¼ˆLifestyleï¼Œå±•ç¤ºäº§å“å®é™…ä½¿ç”¨ï¼‰
æµ·æŠ¥03 - å·¥è‰º/æŠ€æœ¯/æ¦‚å¿µå¯è§†åŒ–ï¼ˆProcess/Conceptï¼ŒåŸºäºè¯†åˆ«çš„å–ç‚¹ï¼‰
æµ·æŠ¥04 - ç»†èŠ‚ç‰¹å†™01ï¼ˆDetail 01ï¼Œæ”¾å¤§äº§å“ç»†èŠ‚ï¼‰
æµ·æŠ¥05 - ç»†èŠ‚ç‰¹å†™02ï¼ˆDetail 02ï¼Œæè´¨/è´¨æ„Ÿç‰¹å†™ï¼‰
æµ·æŠ¥06 - ç»†èŠ‚ç‰¹å†™03ï¼ˆDetail 03ï¼ŒåŠŸèƒ½ç»†èŠ‚ï¼‰
æµ·æŠ¥07 - ç»†èŠ‚ç‰¹å†™04 æˆ– ç”¨æˆ·è¯„ä»·ï¼ˆDetail 04 / Reviewï¼‰
æµ·æŠ¥08 - å“ç‰Œæ•…äº‹/é…è‰²çµæ„Ÿï¼ˆBrand Story / Moodboardï¼Œä½¿ç”¨è¯†åˆ«çš„é…è‰²ï¼‰
æµ·æŠ¥09 - äº§å“å‚æ•°/è§„æ ¼è¡¨ï¼ˆSpecificationsï¼Œä½¿ç”¨è¯†åˆ«çš„å‚æ•°ï¼‰
æµ·æŠ¥10 - ä½¿ç”¨æŒ‡å—/æ³¨æ„äº‹é¡¹ï¼ˆUsage Guideï¼ŒåŸºäºäº§å“ç±»å‹ï¼‰
 æ ¸å¿ƒè¦æ±‚ï¼ˆé‡ä¸­ä¹‹é‡ï¼‰ï¼š
1. äº§å“å›¾è¿˜åŸè¦æ±‚
å¿…é¡»åœ¨æç¤ºè¯ä¸­æ˜ç¡®è¯´æ˜ï¼š  "ä¸¥æ ¼è¿˜åŸä¸Šä¼ çš„äº§å“å›¾ï¼ŒåŒ…æ‹¬åŒ…è£…è®¾è®¡ã€é¢œè‰²ã€LOGOä½ç½®ã€æ–‡å­—å†…å®¹ã€å›¾æ¡ˆå…ƒç´ ç­‰æ‰€æœ‰ç»†èŠ‚" - "äº§å“å¤–è§‚å¿…é¡»ä¸å‚è€ƒå›¾å®Œå…¨ä¸€è‡´ï¼Œä¸å¾—æ”¹å˜åŒ…è£…è®¾è®¡ã€é…è‰²æ–¹æ¡ˆæˆ–å“ç‰Œå…ƒç´ " 
- "ä¿æŒäº§å“çš„çœŸå®æè´¨è´¨æ„Ÿï¼ˆå“‘å…‰/é«˜å…‰/ç£¨ç ‚/é‡‘å±ç­‰ï¼‰" - ä¾‹å¦‚ï¼š"ä½¿ç”¨ä¸Šä¼ çš„æœ—è¯ºRANOVAå†»å¹²é¸¡è‚‰äº§å“åŒ…è£…ï¼Œä¿æŒè“è‰²è¢‹èº«ã€æ°´å½©çŒ«å’ªæ’ç”»ã€é‡‘è‰²LOGOç­‰æ‰€æœ‰è®¾è®¡å…ƒç´ å®Œå…¨ä¸€è‡´"
2. æ–‡æ¡ˆæ’ç‰ˆè¦æ±‚ï¼ˆä¸­è‹±æ–‡åŒè¯­ï¼‰
æ¯å¼ æµ·æŠ¥çš„æ‰€æœ‰æ–‡å­—å†…å®¹éƒ½å¿…é¡»é‡‡ç”¨ä¸­è‹±æ–‡åŒè¯­æ’ç‰ˆï¼š æ ‡é¢˜æ’ç‰ˆæ ¼å¼ï¼ˆ3ç§å¯é€‰ï¼‰ï¼š
æ ¼å¼A - ä¸­è‹±å †å ï¼ˆæœ€å¸¸ç”¨ï¼‰ï¼š çº¯è‚‰å†»å¹² PURE FREEZE-DRIED  ä¸­æ–‡åœ¨ä¸Šï¼ˆè¾ƒå¤§å­—å·ï¼‰ï¼Œè‹±æ–‡åœ¨ä¸‹ï¼ˆè¾ƒå°å­—å·ï¼‰ï¼Œå‚ç›´å †å ï¼Œå±…ä¸­å¯¹é½
æ ¼å¼B - ä¸­è‹±å¹¶åˆ—ï¼š çº¯è‚‰å†»å¹² | PURE FREEZE-DRIED  ä¸­è‹±æ–‡æ¨ªå‘å¹¶åˆ—ï¼Œç”¨ç«–çº¿æˆ–æ–œæ åˆ†éš”ï¼Œå­—å·ç›¸åŒæˆ–ä¸­æ–‡ç•¥å¤§
æ ¼å¼C - ä¸­è‹±åˆ†ç¦»ï¼š çº¯è‚‰å†»å¹²        
[å·¦ä¸Šè§’] PURE FREEZE-DRIED  [å³ä¸‹è§’]  ä¸­è‹±æ–‡åˆ†åˆ«æ”¾ç½®åœ¨ä¸åŒä½ç½®ï¼Œå½¢æˆè§†è§‰å¯¹æ¯”
å–ç‚¹/è¯´æ˜æ–‡å­—æ’ç‰ˆæ ¼å¼ï¼š  100%çº¯è‚‰ / 100% Pure Meat  å†»å¹²é”é²œ / Freeze-Dried Fresh  æ— è°·é…æ–¹ / Grain-Free Formula - ä½¿ç”¨å›¾æ ‡æˆ–ç¬¦å·å¼•å¯¼ - ä¸­æ–‡åœ¨å‰ï¼Œè‹±æ–‡åœ¨åï¼Œç”¨æ–œæ "/"åˆ†éš” - æˆ–é‡‡ç”¨ä¸Šä¸‹å †å ï¼Œä¸­æ–‡åœ¨ä¸Šï¼Œè‹±æ–‡åœ¨ä¸‹ï¼ˆå­—å·ç•¥å°ï¼‰
æ®µè½æ–‡å­—æ’ç‰ˆæ ¼å¼ï¼š åœ¨æ…µæ‡’çš„åˆåï¼Œç»™çˆ±å® ä¸€ä»½å¤©ç„¶ç¾å‘³ã€‚ On a lazy afternoon, give your pet natural deliciousness. RANOVAå†»å¹²é›¶é£Ÿï¼Œç”¨çœŸæå®æ–™å®šä¹‰å¥åº·é›¶é£Ÿæ–°æ ‡å‡†ã€‚ RANOVA freeze-dried snacks redefine healthy treats with real ingredients. - ä¸­æ–‡æ®µè½å’Œè‹±æ–‡æ®µè½åˆ†åˆ«æˆæ®µ - è‹±æ–‡æ®µè½å­—å·ç•¥å°ï¼ˆçº¦ä¸ºä¸­æ–‡çš„80-90%ï¼‰ - ä¿æŒè¡Œè·èˆ’é€‚ï¼ˆ1.5-2.0å€è¡Œé«˜ï¼‰
æŒ‰é’®/CTAæ–‡å­—æ ¼å¼ï¼š ç«‹å³é€‰è´­ SHOP NOW â†’ äº†è§£æ›´å¤š LEARN MORE â†’ - ä¸­è‹±æ–‡å¹¶åˆ—æˆ–ä¸Šä¸‹æ’åˆ— - ç®­å¤´ç¬¦å·ç»Ÿä¸€ä½¿ç”¨ â†’
å‚æ•°è¡¨æ ¼å¼ï¼š | è¥å…»æˆåˆ† Nutrients | å«é‡ Content | | ç²—è›‹ç™½ Crude Protein | â‰¥42% | - è¡¨å¤´å¿…é¡»ä¸­è‹±åŒè¯­ - æ¯ä¸ªå‚æ•°é¡¹éƒ½è¦ä¸­è‹±æ–‡æ ‡æ³¨
3. æ¯å¼ æµ·æŠ¥å¿…é¡»åŒ…å«çš„å…ƒç´ ï¼š ä¸­æ–‡æç¤ºè¯ï¼ˆå®Œæ•´è¯¦ç»†ï¼Œ600-1000å­—ï¼‰ è‹±æ–‡Promptï¼ˆå®Œæ•´ç¿»è¯‘ï¼Œä¸ä¸­æ–‡å¯¹åº”ï¼‰ è´Ÿé¢è¯ï¼ˆNegative Promptsï¼Œ20-30ä¸ªå…³é”®è¯ï¼‰ è¯¦ç»†æ’ç‰ˆå¸ƒå±€è¯´æ˜ï¼ŒåŒ…æ‹¬ï¼š  - æ‰€æœ‰æ–‡å­—çš„å…·ä½“ä½ç½®ï¼ˆå·¦ä¸Š/å³ä¸‹/å±…ä¸­ç­‰ï¼‰  - æ‰€æœ‰æ–‡å­—çš„å­—å·å¤§å°å…³ç³»ï¼ˆè¶…å¤§/å¤§/ä¸­/å°ï¼‰  - æ‰€æœ‰æ–‡å­—çš„é¢œè‰²ï¼ˆå…·ä½“è‰²å€¼æˆ–æè¿°ï¼‰  - æ‰€æœ‰æ–‡å­—çš„å­—ä½“é£æ ¼ï¼ˆç²—è¡¬çº¿/ç»†æ— è¡¬çº¿/æ‰‹å†™ä½“ç­‰ï¼‰  - æ‰€æœ‰æ–‡å­—çš„ä¸­è‹±æ–‡æ’ç‰ˆæ ¼å¼ï¼ˆå †å /å¹¶åˆ—/åˆ†ç¦»ï¼‰ LOGOä½ç½®ï¼ˆé€šå¸¸å·¦ä¸Šè§’ï¼Œç»Ÿä¸€ä½ç½®ï¼‰ CTAæŒ‰é’®è®¾è®¡ï¼ˆä½ç½®ã€æ–‡å­—ã€æ ·å¼ï¼‰
4. é£æ ¼ç»Ÿä¸€åŸåˆ™ï¼š
æ‰€æœ‰æµ·æŠ¥å¿…é¡»ä½¿ç”¨ç›¸åŒçš„æ–‡å­—æ’ç‰ˆæ•ˆæœ - æ‰€æœ‰æµ·æŠ¥å¿…é¡»ä½¿ç”¨ç›¸åŒçš„é…è‰²ç³»ç»Ÿï¼ˆä»äº§å“å›¾æå–ï¼‰ - æ‰€æœ‰æµ·æŠ¥å¿…é¡»ä¿æŒå“ç‰Œè°ƒæ€§ä¸€è‡´ - LOGOåœ¨æ¯å¼ æµ·æŠ¥ä¸­ä½ç½®ç»Ÿä¸€ï¼ˆå·¦ä¸Šè§’ï¼‰ - ä¸­è‹±æ–‡æ’ç‰ˆæ ¼å¼åœ¨æ‰€æœ‰æµ·æŠ¥ä¸­ä¿æŒä¸€è‡´ï¼ˆé€‰å®šä¸€ç§æ ¼å¼åï¼Œ10å¼ æµ·æŠ¥éƒ½ä½¿ç”¨ï¼‰
"""


class DesignGenerator:
    """è®¾è®¡AIç”Ÿæˆå™¨"""
    
    def __init__(self, api_key: str = API_KEY, base_url: str = BASE_URL):
        self.api_key = api_key
        self.base_url = base_url
        self.model_name = MODEL_NAME
    
    def _encode_image(self, path: str) -> str:
        with open(path, "rb") as f:
            return base64.standard_b64encode(f.read()).decode("utf-8")
    
    def _get_media_type(self, path: str) -> str:
        ext = Path(path).suffix.lower()
        types = {".jpg": "image/jpeg", ".jpeg": "image/jpeg", ".png": "image/png", ".webp": "image/webp"}
        return types.get(ext, "image/jpeg")
    
    async def generate(self, text_input: str, image_paths: List[str] = None) -> dict:
        """ç”Ÿæˆè®¾è®¡æ–¹æ¡ˆ"""
        print("\nğŸ¨ è®¾è®¡AIç”Ÿæˆå™¨å¯åŠ¨")
        
        content = [{"type": "text", "text": f"{SYSTEM_PROMPT}\n\n# ç”¨æˆ·éœ€æ±‚\n{text_input}"}]
        
        if image_paths:
            for path in image_paths:
                if os.path.exists(path):
                    try:
                        content.append({
                            "type": "image_url",
                            "image_url": {"url": f"data:{self._get_media_type(path)};base64,{self._encode_image(path)}"}
                        })
                        print(f"  âœ“ åŠ è½½å›¾ç‰‡: {path}")
                    except Exception as e:
                        print(f"  âœ— åŠ è½½å¤±è´¥: {path} - {e}")
        
        result = {"success": False, "raw_response": None, "reasoning": None, "usage": None, "error": None}
        
        try:
            print("  â³ æ­£åœ¨ç”Ÿæˆè®¾è®¡æ–¹æ¡ˆ...")
            async with aiohttp.ClientSession() as session:
                async with session.post(
                    f"{self.base_url}/chat/completions",
                    headers={"Content-Type": "application/json", "Authorization": f"Bearer {self.api_key}"},
                    json={"model": self.model_name, "messages": [{"role": "user", "content": content}], "max_tokens": 16000},
                    timeout=aiohttp.ClientTimeout(total=600)
                ) as response:
                    if response.status != 200:
                        raise Exception(f"APIé”™è¯¯ ({response.status})")
                    data = await response.json()
            
            choice = data.get("choices", [{}])[0]
            message = choice.get("message", {})
            result["raw_response"] = message.get("content", "")
            result["reasoning"] = message.get("reasoning_content", "")
            result["usage"] = data.get("usage", {})
            result["success"] = True
            print(f"  âœ… ç”ŸæˆæˆåŠŸï¼Œé•¿åº¦: {len(result['raw_response'])} å­—ç¬¦")
            
        except asyncio.TimeoutError:
            result["error"] = "è¯·æ±‚è¶…æ—¶"
            print(f"  âŒ {result['error']}")
        except Exception as e:
            result["error"] = str(e)
            print(f"  âŒ é”™è¯¯: {result['error']}")
        
        return result
